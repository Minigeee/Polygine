#ifndef SHADER_ANIMATED_VERT
#define SHADER_ANIMATED_VERT "#version 330 core\n\nlayout (std140) uniform Camera\n{\n    mat4 u_projView;\n    vec3 u_cameraPos;\n    float u_near;\n    float u_far;\n};\n#define MAX_NUM_MATERIALS 4\n#define MAX_NUM_DIR_LIGHTS 2\n#define MAX_NUM_SHADOW_CASCADES 3\n#define MAX_NUM_SHADOW_MAPS MAX_NUM_DIR_LIGHTS * MAX_NUM_SHADOW_CASCADES\n#define MAX_NUM_POINT_LIGHTS 32\n\n\n///////////////////////////////////////////////////////////\nstruct Material\n{\n    vec3 ambient;\n    vec3 diffuse;\n    vec3 specular;\n    float shininess;\n    bool hasDiffTexture;\n    bool hasSpecTexture;\n    bool hasNormalTexture;\n};\nlayout (std140) uniform Shadows\n{\n    uniform mat4 u_lightProjViews[MAX_NUM_SHADOW_MAPS];\n    uniform float u_shadowDists[MAX_NUM_SHADOW_MAPS];\n    uniform float u_shadowStrengths[MAX_NUM_DIR_LIGHTS];\n    uniform int u_numShadowCascades[MAX_NUM_DIR_LIGHTS];\n    uniform int u_numShadows;\n};\n\n// Set up shadows in the vertex shader\n\n///////////////////////////////////////////////////////////\n\nout vec4 v_clipSpacePos;\nout vec4 v_lightClipSpacePos[MAX_NUM_SHADOW_MAPS];\n\n\n///////////////////////////////////////////////////////////\nvoid calcShadowClipSpace(vec4 worldPos)\n{\n    v_clipSpacePos = gl_Position;\n\n    // Calculate light space positions\n    for (int i = 0; i < u_numShadows * MAX_NUM_SHADOW_CASCADES; ++i)\n        v_lightClipSpacePos[i] = u_lightProjViews[i] * worldPos;\n}\n\nlayout (location = 0) in vec3 a_position;\nlayout (location = 1) in vec3 a_normal;\nlayout (location = 2) in vec2 a_texCoord;\nlayout (location = 3) in vec4 a_color;\nlayout (location = 4) in vec3 a_tangent;\nlayout (location = 5) in mat4 a_transform;\nlayout (location = 9) in vec4 a_boneWeights;\nlayout (location = 10) in ivec4 a_boneIds;\n\nout vec3 v_fragPos;\nout vec3 v_normal;\nout vec2 v_texCoord;\nout vec4 v_color;\nout mat3 v_tbnMatrix;\n\nlayout (std140) uniform Skeleton\n{\n    uniform mat4 u_bones[20];\n};\n\nvoid main()\n{\n    mat4 boneTransform = mat4(0.0f);\n    for (int i = 0; i < 4; i++)\n    {\n        if (a_boneIds[i] >= 0)\n            boneTransform += u_bones[a_boneIds[i]] * a_boneWeights[i];\n    }\n\n    mat4 transform = a_transform * boneTransform;\n    vec4 worldPos = transform * vec4(a_position, 1.0);\n    gl_Position =  u_projView * worldPos;\n    v_clipSpacePos = gl_Position;\n    \n    vec3 T = normalize(vec3(a_transform * vec4(a_tangent, 0.0f)));\n    vec3 N = normalize(vec3(a_transform * vec4(a_normal, 0.0f)));\n    T = normalize(T - dot(T, N) * N);\n    vec3 B = cross(N, T);\n    v_tbnMatrix = mat3(T, B, N);\n\n    v_fragPos = worldPos.xyz;\n    v_normal = normalize(mat3(transform) * a_normal);\n    v_texCoord = a_texCoord;\n    v_color = a_color;\n\n    // Set up output variables for shadows\n    calcShadowClipSpace(worldPos);\n}"
#endif