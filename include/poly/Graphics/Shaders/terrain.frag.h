#ifndef SHADER_TERRAIN_FRAG
#define SHADER_TERRAIN_FRAG "#version 330 core\n\nlayout (std140) uniform Camera\n{\n    mat4 u_projView;\n    vec3 u_cameraPos;\n    float u_near;\n    float u_far;\n};\n#define MAX_NUM_MATERIALS 4\n#define MAX_NUM_DIR_LIGHTS 2\n#define MAX_NUM_SHADOW_CASCADES 3\n#define MAX_NUM_SHADOW_MAPS MAX_NUM_DIR_LIGHTS * MAX_NUM_SHADOW_CASCADES\n#define MAX_NUM_POINT_LIGHTS 100\n\n\n///////////////////////////////////////////////////////////\nstruct Material\n{\n    vec3 diffuse;\n    vec3 specular;\n    float shininess;\n    float occlusion;\n    float reflectivity;\n    bool hasDiffTexture;\n    bool hasSpecTexture;\n    bool hasNormalTexture;\n};\n\nlayout (location = 0) out vec4 f_normalShininess;\nlayout (location = 1) out vec4 f_albedoOcclusion;\nlayout (location = 2) out vec4 f_specularReflectivity;\n\n\n///////////////////////////////////////////////////////////\nvoid deferred(Material material, vec3 normal)\n{\n    f_normalShininess = vec4(normal, material.shininess);\n    f_albedoOcclusion = vec4(material.diffuse, material.occlusion);\n    f_specularReflectivity = vec4(material.specular, material.reflectivity);\n}\n\n///////////////////////////////////////////////////////////\n\nin vec3 v_fragPos;\nin vec3 v_normal;\nin vec3 v_color;\nflat in int v_chunk;\n\nlayout (std140) uniform Terrain\n{\n    uniform float u_chunkSize;\n    uniform float u_maxHeight;\n    uniform float u_tileScale;\n    uniform float u_blendLodDist;\n    uniform bool u_useFlatShading;\n};\n\nuniform Material u_material;\nuniform sampler2D u_normalMaps[9];\nuniform sampler2D u_colorMaps[9];\n\n///////////////////////////////////////////////////////////\n\nvoid main()\n{\n    vec2 chunkCenter = round(v_fragPos.xz / u_chunkSize) * u_chunkSize;\n    vec2 texCoord = clamp((v_fragPos.xz - chunkCenter) / u_chunkSize + 0.5f, 0.0f, 1.0f);\n\n    vec2 mapSize = textureSize(u_normalMaps[v_chunk], 0);\n    vec2 ntexCoord = (mapSize - 1.0f) / mapSize * texCoord + 0.5f / mapSize;\n    vec3 normal = u_useFlatShading ? v_normal : texture(u_normalMaps[v_chunk], ntexCoord).rgb;\n\n    mapSize = textureSize(u_colorMaps[v_chunk], 0);\n    vec2 ctexCoord = (mapSize - 1.0f) / mapSize * texCoord + 0.5f / mapSize;\n    vec3 color = u_useFlatShading ? v_color : texture(u_colorMaps[v_chunk], ctexCoord).rgb;\n\n    // Create terrain material\n    Material material;\n    material.diffuse = color;\n    material.specular = u_material.specular;\n    material.shininess = u_material.shininess;\n    material.occlusion = u_material.occlusion;\n    material.reflectivity = u_material.reflectivity;\n    \n    // Output to color buffers\n    deferred(material, normal);\n}"
#endif